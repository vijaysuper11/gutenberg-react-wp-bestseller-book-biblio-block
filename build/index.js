(()=>{"use strict";var e,r={797:()=>{const e=window.wp.blocks,r=window.wp.blockEditor,s=window.wp.components,t=window.wp.element,l=window.ReactJSXRuntime;(0,e.registerBlockType)("bestsellers/block",{title:"Bestsellers Block",icon:"book",category:"widgets",attributes:{genre:{type:"string",default:""},title:{type:"string",default:"Bestsellers"}},edit:({attributes:e,setAttributes:a})=>{const{genre:n,title:o}=e,[i,c]=(0,t.useState)([]),[h,d]=(0,t.useState)(!0),[u,b]=(0,t.useState)([]),[p,g]=(0,t.useState)(!1),[f,w]=(0,t.useState)(""),[k,v]=(0,t.useState)([]);return(0,t.useEffect)((()=>{(async()=>{d(!0);try{const e=await fetch("/wp-json/bestsellers/v1/genres");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const r=await e.json();if(r.categories&&Array.isArray(r.categories)){const e=r.categories.map((e=>({label:e.description||"Unknown Category",value:e.catUri||""})));c(e),v(e)}else c([]),v([])}catch(e){console.error("Error fetching genres:",e),c([]),v([])}finally{d(!1)}})()}),[]),(0,t.useEffect)((()=>{n?(async()=>{g(!0);try{const e=await fetch(`/wp-json/bestsellers/v1/books?catUri=${n}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const r=await e.json();if(Array.isArray(r)&&r.length>0){const e=r.map((e=>({title:e.title,authors:e.authors.map((e=>e.authorDisplay)),image:e.coverUrls?.medium?.coverUrl||"fallback-image-url.jpg",affiliateLinks:e.affiliateLinks,seoFriendlyUrl:e.seoFriendlyUrl,isbn:e.isbn})));b(e)}else b([])}catch(e){console.error("Error fetching books:",e),b([])}finally{g(!1)}})():b([])}),[n]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.InspectorControls,{children:(0,l.jsx)(s.PanelBody,{title:"Settings",children:h?(0,l.jsx)(s.Spinner,{}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.TextControl,{label:"Search Genre",value:f,onChange:e=>{console.log("Search value:",e);const r=e||"";if(w(r),r.length>=2){const e=i.filter((e=>e.label.toLowerCase().includes(r.toLowerCase())));v(e)}else v(i)},placeholder:"Search for genres..."}),(0,l.jsx)(s.SelectControl,{label:"Select Genre",value:n,options:[{label:"Select a genre",value:""},...k],onChange:e=>{a({genre:e})}})]})})}),(0,l.jsxs)("div",{className:"bestsellers-block",children:[(0,l.jsx)(r.RichText,{tagName:"h3",value:o,onChange:e=>a({title:e}),placeholder:"Enter block title"}),p?(0,l.jsx)(s.Spinner,{}):u.length>0?(0,l.jsx)("div",{className:"book-display",children:u.map(((e,r)=>{const s=`https://www.penguin.co.uk/${e.seoFriendlyUrl||""}/${e.isbn||""}`;return(0,l.jsxs)("div",{className:"book-card",children:[(0,l.jsx)("a",{href:s,target:"_blank",rel:"noopener noreferrer",children:(0,l.jsx)("img",{src:e.image?.startsWith("https")?e.image.split("https:")[1]:e.image||"fallback-image-url.jpg",alt:e.title||"No Title Available"})}),(0,l.jsx)("h4",{children:e.title||"Unknown Title"}),(0,l.jsx)("span",{className:"author-name",children:e.authors?.join(", ")||"Unknown Author"}),(0,l.jsx)("div",{className:"affiliate-links",children:e.affiliateLinks?.map(((e,r)=>"amazon"===e.affiliateType?(0,l.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"buy-now-button",children:"BUY FROM AMAZON"},r):null))||(0,l.jsx)("p",{children:"No purchase links available"})})]},r)}))}):(0,l.jsx)("p",{children:"No books available. Please select a different genre."})]})]})},save:({attributes:e})=>{const{genre:r,title:s}=e;return(0,l.jsxs)("div",{className:"bestsellers-block",children:[(0,l.jsx)("h3",{children:s}),(0,l.jsx)("div",{className:"bestsellers-carousel","data-genre":r,children:(0,l.jsx)("p",{children:"Books will be dynamically loaded here based on the selected genre."})})]})}})}},s={};function t(e){var l=s[e];if(void 0!==l)return l.exports;var a=s[e]={exports:{}};return r[e](a,a.exports,t),a.exports}t.m=r,e=[],t.O=(r,s,l,a)=>{if(!s){var n=1/0;for(h=0;h<e.length;h++){for(var[s,l,a]=e[h],o=!0,i=0;i<s.length;i++)(!1&a||n>=a)&&Object.keys(t.O).every((e=>t.O[e](s[i])))?s.splice(i--,1):(o=!1,a<n&&(n=a));if(o){e.splice(h--,1);var c=l();void 0!==c&&(r=c)}}return r}a=a||0;for(var h=e.length;h>0&&e[h-1][2]>a;h--)e[h]=e[h-1];e[h]=[s,l,a]},t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),(()=>{var e={57:0,350:0};t.O.j=r=>0===e[r];var r=(r,s)=>{var l,a,[n,o,i]=s,c=0;if(n.some((r=>0!==e[r]))){for(l in o)t.o(o,l)&&(t.m[l]=o[l]);if(i)var h=i(t)}for(r&&r(s);c<n.length;c++)a=n[c],t.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return t.O(h)},s=globalThis.webpackChunkwordpress_bestsellers_block=globalThis.webpackChunkwordpress_bestsellers_block||[];s.forEach(r.bind(null,0)),s.push=r.bind(null,s.push.bind(s))})();var l=t.O(void 0,[350],(()=>t(797)));l=t.O(l)})();